@model IEnumerable<TaskItem>

@{
    var list = (Model ?? Enumerable.Empty<TaskItem>()).Where(t => t != null).ToList();
}

@if (!list.Any())
{
    <div class="text-muted">No tasks.</div>
}
else
{
    <div class="list-group">
        @foreach (var t in list)
        {
            <div class="list-group-item">
                <div class="row align-items-center">
                    <div class="col-12 col-md-7">
                        <div class="fw-semibold">@t.TaskName</div>

                        <div class="small text-muted">
                            @* Only show due date if it's a real date *@
                            @if (t.DueDate > new DateTime(1900, 1, 1))
                            {
                                <span>Due: @t.DueDate.ToString("yyyy-MM-dd")</span>
                                <span class="mx-1">•</span>
                            }

                            @if (t.Category != null)
                            {
                                <span>@t.Category.Name</span>
                            }
                            else
                            {
                                <span>Category: (not set)</span>
                            }
                        </div>
                    </div>

                    <div class="col-12 col-md-5 mt-2 mt-md-0">
                        <div class="d-flex flex-wrap gap-2 justify-content-md-end">
                            <a class="btn btn-sm btn-outline-primary"
                               asp-action="Edit"
                               asp-route-id="@t.TaskItemId">
                                Edit
                            </a>

                            <form asp-action="Delete" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@t.TaskItemId" />
                                <button type="submit" class="btn btn-sm btn-outline-danger"
                                        onclick="return confirm('Delete this task?');">
                                    Delete
                                </button>
                            </form>

                            <form asp-action="Complete" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@t.TaskItemId" />
                                <button type="submit" class="btn btn-sm btn-success">
                                    Complete
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}